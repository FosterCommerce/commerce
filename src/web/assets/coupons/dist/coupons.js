(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}"undefined"===e(Craft.Commerce)&&(Craft.Commerce={}),Craft.Commerce.Coupons=Garnish.Base.extend({couponBtnSelector:null,couponTable:null,tempTableId:null,$couponsBtn:null,$couponsContainer:null,$generateBtn:null,$slideout:null,$slideoutContents:null,init:function(e,t){this.couponBtnSelector=e,this.setSettings(t,Craft.Commerce.Coupons.defaults),this.$couponsBtn=document.querySelector(this.couponBtnSelector),this.$couponsContainer=document.querySelector(this.settings.couponsContainerSelector),this.$couponsContainerInner=document.querySelector(this.settings.couponsContainerInnerSelector),this.$slideoutContents=this.$couponsContainer.cloneNode(!0),this.tempTableId=this.$slideoutContents.querySelector("table.editable").id,this.$slideoutContents.querySelector("table.editable").id=this.settings.tableSlideoutId,this.$generateBtn=this.$slideoutContents.querySelector(this.settings.generateBtnSelector),this._addListeners()},_addListeners:function(){this.addListener(this.$couponsBtn,"click","openSlideout"),this.addListener(this.$generateBtn,"click","generateCoupons")},openSlideout:function(e){var t=this;e.preventDefault(),this.$slideout=new Craft.Slideout(this.$slideoutContents,{autoOpen:!1,containerElement:"form",containerAttributes:{action:"",method:"post",novalidate:"",class:"coupon-editor"}}),this.$slideout.on("open",(function(){setTimeout(function(){this.couponTable=new Craft.EditableTable(this.settings.tableSlideoutId,this.settings.table.name,this.settings.table.cols,{defaultValues:this.settings.table.defaultValues,staticRows:!1,minRows:null,allowAdd:!0,allowDelete:!0,maxRows:null,onDeleteRow:this.onDeleteCoupon})}.bind(t),300)})),this.$slideout.on("close",(function(){t.$slideoutContents.querySelector("#".concat(t.settings.tableSlideoutId)).id=t.tempTableId,t.$couponsContainer.replaceChild(t.$slideoutContents.querySelector(t.settings.couponsContainerInnerSelector),t.$couponsContainerInner),t.$slideout.destroy()})),this.$slideout.open()},generateCoupons:function(e){var t=this;e.preventDefault(),Craft.postActionRequest("commerce/discounts/generate-coupons",this.getGenerateData(),(function(e,n){"success"===n?t.appendCoupons(e.coupons):console.log("throw an error")}))},appendCoupons:function(e){e&&e.length&&(console.log(this.couponTable,this.couponTable.$addRowBtn),console.log(this.couponTable.$table,this.couponTable.$addRowBtn),this.couponTable.addRow(!1).$tr.find(".singleline-cell:first textarea").val("testing"))},getGenerateData:function(){if(!this.$slideoutContents)return{};var e=this.$slideoutContents.querySelector("input[name=count]"),t=this.$slideoutContents.querySelector("input[name=length]");return{count:e.value,length:t.value}},onDeleteCoupon:function(e){console.log(e)}},{defaults:{couponsContainerInnerSelector:"#commerce-coupons-inner",couponsContainerSelector:"#commerce-coupons",generateSelectors:{count:"input[name=count]",length:"input[name=length]"},table:{},tableId:"coupons-table",tableSlideoutId:"slideout-coupons"}})})();
//# sourceMappingURL=coupons.js.map