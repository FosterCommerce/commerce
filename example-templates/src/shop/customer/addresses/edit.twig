{% extends '[[folderName]]/_private/layouts' %}

{% if not currentUser %}
    {% exit 404 %}
{% endif %}

{% block main %}

    {% set addressId = craft.app.request.param('addressId') %}
    {% set redirect = craft.app.request.param('redirect') %}
    {% set countryCode = craft.app.request.param('countryCode') %}

    {% if addressId %}
        {% set address = craft.addresses.id(addressId).ownerId(currentUser.id).one() %}
        {% if not address %}
            {% exit 404 %}
        {% endif %}
    {% else %}
        {% set address = create({
            class: 'craft\\elements\\Address',
            ownerId: currentUser.id,
            countryCode: countryCode ?? 'US'
        }) %}
    {% endif %}

    <!-- Template: {{ _self }}.twig -->
    <h1 class="text-xl font-semibold">
        {% if addressId %}
            {{- 'Edit address'|t -}}
        {% else %}
            {{- 'Add a new address'|t -}}
        {% endif %}
    </h1>

    <form method="post" action="">
        {{ csrfInput() }}
        {{ actionInput('elements/save') }}
        {{ redirectInput(redirect ?: '[[folderName]]/customer/addresses') }}

        {% if addressId %}
            {{ hiddenInput('elementId', addressId) }}
        {% endif %}

        {{ include('[[folderName]]/_private/address/fields', {
            address: address
        }) }}
        {{ hiddenInput('ownerId', currentUser.id) }}

        <hr class="my-3"/>

        <div class="mt-6 flex justify-between">
            <div>
                <a href="{{ redirect ? '/' ~ redirect : url('[[folderName]]/customer/addresses') }}"
                   class="text-blue-500 hover:text-blue-600"
                >
                    {{- 'Cancel'|t -}}
                </a>
            </div>
            <div>
                {{ tag('button', {
                    type: 'submit',
                    class: 'cursor-pointer rounded px-4 py-2 inline-block bg-blue-500 hover:bg-blue-600 text-white hover:text-white',
                    text: 'Save Address'|t
                }) }}
            </div>
        </div>
    </form>
{% endblock %}
